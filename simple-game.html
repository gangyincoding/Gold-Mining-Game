<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>黄金矿工 - 简单版</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #2c3e50;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #gameCanvas {
            border: 3px solid #34495e;
            border-radius: 10px;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 30%, #8B7355 30%, #654321 100%);
        }

        .game-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
            font-size: 18px;
            text-align: center;
            min-width: 300px;
        }

        .controls {
            margin-top: 20px;
            text-align: center;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
        }

        button:hover {
            background: #2980b9;
        }

        .debug {
            margin-top: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            color: #ecf0f1;
            max-width: 800px;
        }
    </style>
</head>
<body>
    <div class="game-info">
        <div>分数: <span id="score">0</span> | 关卡: <span id="level">1</span> | 时间: <span id="time">60</span>秒</div>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div class="controls">
        <button onclick="startGame()">开始游戏</button>
        <button onclick="pauseGame()">暂停</button>
        <button onclick="resetGame()">重置</button>
        <div style="margin-top: 10px;">
            <label>钩子速度: </label>
            <button onclick="adjustSpeed(-0.2)">减慢</button>
            <span id="speedDisplay">0.8</span>
            <button onclick="adjustSpeed(0.2)">加快</button>
        </div>
    </div>

    <div class="debug" id="debug">
        调试信息将显示在这里...
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const debug = document.getElementById('debug');

        // 游戏状态
        let gameState = 'stopped'; // stopped, playing, paused
        let score = 0;
        let level = 1;
        let timeLeft = 60;
        let gameTimer = null;

        // 钩子
        const hook = {
            x: 400,
            y: 100,
            length: 50,
            angle: 0,
            angleSpeed: 0.8,  // 降低摆动速度，从2降到0.8
            state: 'rotating', // rotating, extending, retracting
            speed: 4,         // 降低延伸速度，从5降到4
            maxLength: 400,
            caughtItem: null
        };

        // 物品
        let items = [];

        // 简单的物品类型
        function createItem(type, x, y, value, color) {
            return {
                type: type,
                x: x,
                y: y,
                width: type === 'diamond' ? 30 : 50,
                height: type === 'diamond' ? 30 : 50,
                value: value,
                color: color
            };
        }

        // 初始化关卡
        function initLevel() {
            items = [];

            if (level === 1) {
                // 第1关：简单的物品分布
                items.push(createItem('gold', 200, 350, 100, '#FFD700'));
                items.push(createItem('gold', 400, 400, 150, '#FFA500'));
                items.push(createItem('diamond', 600, 350, 500, '#00CED1'));
                items.push(createItem('stone', 300, 450, 20, '#808080'));
                items.push(createItem('gold', 500, 380, 200, '#FFD700'));
            } else {
                // 第2关及以后：随机生成
                for (let i = 0; i < 5; i++) {
                    const x = 150 + i * 125;
                    const y = 350 + Math.random() * 100;
                    const rand = Math.random();

                    if (rand < 0.6) {
                        items.push(createItem('gold', x, y, 100 + Math.floor(Math.random() * 200), '#FFD700'));
                    } else if (rand < 0.8) {
                        items.push(createItem('stone', x, y, 20, '#808080'));
                    } else {
                        items.push(createItem('diamond', x, y, 500, '#00CED1'));
                    }
                }
            }

            updateDebug(`关卡 ${level} 初始化完成，生成了 ${items.length} 个物品`);
        }

        // 绘制背景
        function drawBackground() {
            // 天空
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height * 0.3);

            // 地面
            ctx.fillStyle = '#8B7355';
            ctx.fillRect(0, canvas.height * 0.3, canvas.width, canvas.height * 0.7);

            // 地面线
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height * 0.3);
            ctx.lineTo(canvas.width, canvas.height * 0.3);
            ctx.stroke();
        }

        // 绘制钩子
        function drawHook() {
            // 正确的角度计算 (sin/cos方法)
            const angleRad = hook.angle * Math.PI / 180;
            const tipX = hook.x + Math.sin(angleRad) * hook.length;
            const tipY = hook.y + Math.cos(angleRad) * hook.length;

            // 绘制钩子线
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(hook.x, hook.y);
            ctx.lineTo(tipX, tipY);
            ctx.stroke();

            // 绘制钩子
            ctx.save();
            ctx.translate(tipX, tipY);
            ctx.rotate(hook.angle * Math.PI / 180);
            ctx.strokeStyle = '#696969';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(-10, 15);
            ctx.lineTo(10, 15);
            ctx.closePath();
            ctx.stroke();
            ctx.restore();

            // 如果抓到物品
            if (hook.caughtItem) {
                ctx.fillStyle = hook.caughtItem.color;
                ctx.fillRect(tipX - hook.caughtItem.width/2, tipY + 20,
                           hook.caughtItem.width, hook.caughtItem.height);
            }

            // 矿工
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(hook.x - 20, hook.y - 40, 40, 40);
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.arc(hook.x, hook.y - 60, 15, 0, Math.PI * 2);
            ctx.fill();
        }

        // 绘制物品
        function drawItems() {
            items.forEach(item => {
                ctx.fillStyle = item.color;

                if (item.type === 'diamond') {
                    // 钻石 - 简单的菱形
                    ctx.save();
                    ctx.translate(item.x, item.y);
                    ctx.rotate(Math.PI / 4);
                    ctx.fillRect(-item.width/2, -item.height/2, item.width, item.height);
                    ctx.restore();
                } else if (item.type === 'stone') {
                    // 石头 - 圆形
                    ctx.beginPath();
                    ctx.arc(item.x, item.y, item.width/2, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // 金块 - 矩形
                    ctx.fillRect(item.x - item.width/2, item.y - item.height/2,
                               item.width, item.height);
                }

                // 价值标签
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('$' + item.value, item.x, item.y);
            });
        }

        // 更新钩子
        function updateHook() {
            if (hook.state === 'rotating') {
                hook.angle += hook.angleSpeed;
                if (hook.angle > 80 || hook.angle < -80) {
                    hook.angleSpeed = -hook.angleSpeed;
                }

                // 调试：显示当前角度
                if (Math.abs(hook.angle + 38.66) < 2) {
                    updateDebug(`钩子角度: ${hook.angle.toFixed(1)}° - 接近左石头角度!`);
                }
            } else if (hook.state === 'extending') {
                hook.length += hook.speed;
                if (hook.length >= hook.maxLength || hook.caughtItem) {
                    hook.state = 'retracting';
                }
                checkCollision();
            } else if (hook.state === 'retracting') {
                const retractSpeed = hook.caughtItem ? hook.speed * 0.7 : hook.speed * 1.2;
                hook.length -= retractSpeed;
                if (hook.length <= 50) {
                    hook.length = 50;
                    hook.state = 'rotating';

                    if (hook.caughtItem) {
                        score += hook.caughtItem.value;
                        updateScore();
                        hook.caughtItem = null;
                    }
                }
            }
        }

        // 碰撞检测 - 使用正确的sin/cos方法
        function checkCollision() {
            if (hook.caughtItem) return;

            // 正确的角度计算 (sin/cos方法)
            const angleRad = hook.angle * Math.PI / 180;
            const hookTipX = hook.x + Math.sin(angleRad) * hook.length;
            const hookTipY = hook.y + Math.cos(angleRad) * hook.length;

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const left = item.x - item.width/2;
                const right = item.x + item.width/2;
                const top = item.y - item.height/2;
                const bottom = item.y + item.height/2;

                if (hookTipX >= left && hookTipX <= right &&
                    hookTipY >= top && hookTipY <= bottom) {

                    hook.caughtItem = item;
                    hook.state = 'retracting';
                    items.splice(i, 1);

                    updateDebug(`抓取到 ${item.type}，价值 $${item.value}`);
                    break;
                }
            }
        }

        // 游戏循环
        function gameLoop() {
            if (gameState !== 'playing') return;

            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 绘制
            drawBackground();
            drawItems();
            drawHook();

            // 更新
            updateHook();

            // 检查胜利条件
            if (items.length === 0) {
                nextLevel();
            }

            requestAnimationFrame(gameLoop);
        }

        // 开始游戏
        function startGame() {
            if (gameState === 'playing') return;

            gameState = 'playing';
            score = 0;
            level = 1;
            timeLeft = 60;
            hook.state = 'rotating';
            hook.length = 50;
            hook.caughtItem = null;

            updateScore();
            initLevel();

            // 开始计时
            if (gameTimer) clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTime();
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            gameLoop();
            updateDebug('游戏开始！');
        }

        // 暂停游戏
        function pauseGame() {
            if (gameState === 'playing') {
                gameState = 'paused';
                if (gameTimer) clearInterval(gameTimer);
                updateDebug('游戏暂停');
            } else if (gameState === 'paused') {
                gameState = 'playing';
                gameTimer = setInterval(() => {
                    timeLeft--;
                    updateTime();
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
                gameLoop();
                updateDebug('游戏继续');
            }
        }

        // 重置游戏
        function resetGame() {
            gameState = 'stopped';
            if (gameTimer) clearInterval(gameTimer);
            score = 0;
            level = 1;
            timeLeft = 60;
            hook.state = 'rotating';
            hook.length = 50;
            hook.caughtItem = null;
            items = [];
            updateScore();
            updateTime();
            updateLevel();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            updateDebug('游戏已重置');
        }

        // 下一关
        function nextLevel() {
            level++;
            updateLevel();
            timeLeft = Math.max(30, timeLeft - 10);
            hook.speed = Math.min(8, hook.speed + 0.5);
            initLevel();
            updateDebug(`进入第 ${level} 关！钩子速度提升到 ${hook.speed}`);
        }

        // 游戏结束
        function endGame() {
            gameState = 'stopped';
            if (gameTimer) clearInterval(gameTimer);
            updateDebug(`游戏结束！最终得分：${score}`);
            alert(`游戏结束！\n最终得分：${score}\n达到关卡：${level}`);
        }

        // 更新显示
        function updateScore() {
            document.getElementById('score').textContent = score;
        }

        function updateTime() {
            document.getElementById('time').textContent = timeLeft;
        }

        function updateLevel() {
            document.getElementById('level').textContent = level;
        }

        function updateDebug(message) {
            debug.textContent = new Date().toLocaleTimeString() + ': ' + message;
        }

        // 点击事件
        canvas.addEventListener('click', () => {
            if (gameState === 'playing' && hook.state === 'rotating') {
                hook.state = 'extending';
                updateDebug(`钩子延伸，当前角度：${hook.angle.toFixed(1)}°`);
            }
        });

        // 调整钩子速度
        function adjustSpeed(delta) {
            hook.angleSpeed = Math.max(0.2, Math.min(3, hook.angleSpeed + delta));
            document.getElementById('speedDisplay').textContent = hook.angleSpeed.toFixed(1);
            updateDebug(`钩子摆动速度调整为: ${hook.angleSpeed.toFixed(1)}`);
        }

        // 初始化
        drawBackground();
        updateDebug('游戏准备就绪，点击"开始游戏"按钮开始');
        document.getElementById('speedDisplay').textContent = hook.angleSpeed.toFixed(1);
    </script>
</body>
</html>